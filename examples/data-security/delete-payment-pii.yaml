name: delete-payment-pii
description: Remove credit card numbers from purchase events for PCI-DSS compliance
type: pipeline
namespace: default
labels:
  category: data-security
  compliance: pci-dss
  use-case: payment-processing
priority: 100
selector: {}
deployment: {}

config:
  # Accept purchase events via HTTP
  input:
    http_server:
      address: "0.0.0.0:8080"
      path: /events/purchase
      allowed_verbs:
        - POST

  # Remove high-risk payment PII
  pipeline:
    processors:
      # Delete full card number and expiry date
      - mapping: |
          root = this
          
          # Remove PCI-DSS sensitive fields
          # Keep last_four for analytics (fraud detection, payment trends)
          root.payment_method = this.payment_method.without(
            "full_number",
            "expiry"
          )

  # Forward to analytics service
  output:
    http_client:
      url: http://analytics-service:8080/events
      verb: POST
      headers:
        Content-Type: application/json

# Logging configuration
logger:
  level: INFO
  add_timestamp: true
  format: json

# Metrics configuration
metrics:
  prometheus:
    enabled: true


import type { Stage } from '@site/src/components/DataPipelineExplorer/types';

export const enrichExportStages: Stage[] = [
  {
    id: 1,
    title: "Original Log Data",
    description: "Raw application logs generated by your services. No enrichment yet - just basic event information that needs lineage tracking and restructuring for analytics.",
    yamlFilename: "input.yaml",
    yamlCode: `input:
  generate:
    interval: 2s
    mapping: |
      root.id = uuid_v4()
      root.timestamp = now()
      root.level = "INFO"
      root.service = "demo-service"
      root.message = "Demo log message from edge"
      root.user_id = "user_123"
      root.request_id = uuid_v4()`,
    inputLines: [
      { content: '{', indent: 0 },
      { content: '"id": "a1b2c3d4-e5f6-7890-abcd-ef1234567890",', indent: 1, key: 'id', valueType: 'string' },
      { content: '"timestamp": "2024-01-15T10:30:00Z",', indent: 1, key: 'timestamp', valueType: 'string' },
      { content: '"level": "INFO",', indent: 1, key: 'level', valueType: 'string' },
      { content: '"service": "demo-service",', indent: 1, key: 'service', valueType: 'string' },
      { content: '"message": "Demo log message from edge",', indent: 1, key: 'message', valueType: 'string' },
      { content: '"user_id": "user_123",', indent: 1, key: 'user_id', valueType: 'string' },
      { content: '"request_id": "b2c3d4e5-f6a7-8901-bcde-f12345678901"', indent: 1, key: 'request_id', valueType: 'string' },
      { content: '}', indent: 0 },
    ],
    outputLines: [
      { content: '{', indent: 0 },
      { content: '"id": "a1b2c3d4-e5f6-7890-abcd-ef1234567890",', indent: 1, key: 'id', valueType: 'string' },
      { content: '"timestamp": "2024-01-15T10:30:00Z",', indent: 1, key: 'timestamp', valueType: 'string' },
      { content: '"level": "INFO",', indent: 1, key: 'level', valueType: 'string' },
      { content: '"service": "demo-service",', indent: 1, key: 'service', valueType: 'string' },
      { content: '"message": "Demo log message from edge",', indent: 1, key: 'message', valueType: 'string' },
      { content: '"user_id": "user_123",', indent: 1, key: 'user_id', valueType: 'string' },
      { content: '"request_id": "b2c3d4e5-f6a7-8901-bcde-f12345678901"', indent: 1, key: 'request_id', valueType: 'string' },
      { content: '}', indent: 0 },
    ],
  },
  {
    id: 2,
    title: "Add Lineage Metadata",
    description: "Enhanced with processing metadata including node ID, pipeline name, and processing timestamp for complete audit trails.",
    yamlFilename: "step-1-lineage.yaml",
    yamlCode: `pipeline:
  processors:
    - mapping: |
        root = this
        root.lineage_node_id = env("NODE_ID").or("edge-node-demo")
        root.lineage_pipeline = "log-enrichment-s3-demo"
        root.lineage_timestamp = now()`,
    inputLines: [
      { content: '{', indent: 0 },
      { content: '"id": "a1b2c3d4-e5f6-7890-abcd-ef1234567890",', indent: 1, key: 'id', valueType: 'string' },
      { content: '"timestamp": "2024-01-15T10:30:00Z",', indent: 1, key: 'timestamp', valueType: 'string' },
      { content: '"level": "INFO",', indent: 1, key: 'level', valueType: 'string' },
      { content: '"service": "demo-service",', indent: 1, key: 'service', valueType: 'string' },
      { content: '"message": "Demo log message from edge",', indent: 1, key: 'message', valueType: 'string' },
      { content: '"user_id": "user_123",', indent: 1, key: 'user_id', valueType: 'string' },
      { content: '"request_id": "b2c3d4e5-f6a7-8901-bcde-f12345678901"', indent: 1, key: 'request_id', valueType: 'string' },
      { content: '}', indent: 0 },
    ],
    outputLines: [
      { content: '{', indent: 0 },
      { content: '"id": "a1b2c3d4-e5f6-7890-abcd-ef1234567890",', indent: 1, key: 'id', valueType: 'string' },
      { content: '"timestamp": "2024-01-15T10:30:00Z",', indent: 1, key: 'timestamp', valueType: 'string' },
      { content: '"level": "INFO",', indent: 1, key: 'level', valueType: 'string' },
      { content: '"service": "demo-service",', indent: 1, key: 'service', valueType: 'string' },
      { content: '"message": "Demo log message from edge",', indent: 1, key: 'message', valueType: 'string' },
      { content: '"user_id": "user_123",', indent: 1, key: 'user_id', valueType: 'string' },
      { content: '"request_id": "b2c3d4e5-f6a7-8901-bcde-f12345678901",', indent: 1, key: 'request_id', valueType: 'string' },
      { content: '"lineage_node_id": "edge-node-01",', indent: 1, key: 'lineage_node_id', valueType: 'string', type: 'added' },
      { content: '"lineage_pipeline": "log-enrichment-s3-demo",', indent: 1, key: 'lineage_pipeline', valueType: 'string', type: 'added' },
      { content: '"lineage_timestamp": "2024-01-15T10:30:00.123Z"', indent: 1, key: 'lineage_timestamp', valueType: 'string', type: 'added' },
      { content: '}', indent: 0 },
    ],
  },
  {
    id: 3,
    title: "Restructure to Event/Metadata",
    description: "Reorganized into clean separation between business event data and operational metadata for analytics optimization.",
    yamlFilename: "step-2-restructure.yaml",
    yamlCode: `pipeline:
  processors:
    - mapping: |
        root.event = {
          "id": this.id,
          "timestamp": this.timestamp,
          "level": this.level,
          "service": this.service,
          "message": this.message,
          "user_id": this.user_id,
          "request_id": this.request_id
        }
        root.metadata = {
          "node_id": this.lineage_node_id,
          "pipeline": this.lineage_pipeline,
          "processed_at": this.lineage_timestamp
        }`,
    inputLines: [
      { content: '{', indent: 0 },
      { content: '"id": "a1b2c3d4-e5f6-7890-abcd-ef1234567890",', indent: 1, key: 'id', valueType: 'string' },
      { content: '"timestamp": "2024-01-15T10:30:00Z",', indent: 1, key: 'timestamp', valueType: 'string' },
      { content: '"level": "INFO",', indent: 1, key: 'level', valueType: 'string' },
      { content: '"service": "demo-service",', indent: 1, key: 'service', valueType: 'string' },
      { content: '"message": "Demo log message from edge",', indent: 1, key: 'message', valueType: 'string' },
      { content: '"user_id": "user_123",', indent: 1, key: 'user_id', valueType: 'string' },
      { content: '"request_id": "b2c3d4e5-f6a7-8901-bcde-f12345678901",', indent: 1, key: 'request_id', valueType: 'string' },
      { content: '"lineage_node_id": "edge-node-01",', indent: 1, key: 'lineage_node_id', valueType: 'string' },
      { content: '"lineage_pipeline": "log-enrichment-s3-demo",', indent: 1, key: 'lineage_pipeline', valueType: 'string' },
      { content: '"lineage_timestamp": "2024-01-15T10:30:00.123Z"', indent: 1, key: 'lineage_timestamp', valueType: 'string' },
      { content: '}', indent: 0 },
    ],
    outputLines: [
      { content: '{', indent: 0 },
      { content: '"event": {', indent: 1, type: 'highlighted' },
      { content: '"id": "a1b2c3d4-e5f6-7890-abcd-ef1234567890",', indent: 2, key: 'id', valueType: 'string', type: 'highlighted' },
      { content: '"timestamp": "2024-01-15T10:30:00Z",', indent: 2, key: 'timestamp', valueType: 'string', type: 'highlighted' },
      { content: '"level": "INFO",', indent: 2, key: 'level', valueType: 'string', type: 'highlighted' },
      { content: '"service": "demo-service",', indent: 2, key: 'service', valueType: 'string', type: 'highlighted' },
      { content: '"message": "Demo log message from edge",', indent: 2, key: 'message', valueType: 'string', type: 'highlighted' },
      { content: '"user_id": "user_123",', indent: 2, key: 'user_id', valueType: 'string', type: 'highlighted' },
      { content: '"request_id": "b2c3d4e5-f6a7-8901-bcde-f12345678901"', indent: 2, key: 'request_id', valueType: 'string', type: 'highlighted' },
      { content: '},', indent: 1, type: 'highlighted' },
      { content: '"metadata": {', indent: 1, type: 'highlighted' },
      { content: '"node_id": "edge-node-01",', indent: 2, key: 'node_id', valueType: 'string', type: 'highlighted' },
      { content: '"pipeline": "log-enrichment-s3-demo",', indent: 2, key: 'pipeline', valueType: 'string', type: 'highlighted' },
      { content: '"processed_at": "2024-01-15T10:30:00.123Z"', indent: 2, key: 'processed_at', valueType: 'string', type: 'highlighted' },
      { content: '}', indent: 1, type: 'highlighted' },
      { content: '}', indent: 0 },
    ],
  },
  {
    id: 4,
    title: "Configure Batching",
    description: "Messages grouped efficiently (10 messages or 10 seconds) to minimize S3 API calls and storage costs.",
    yamlFilename: "step-3-batching.yaml",
    yamlCode: `output:
  aws_s3:
    bucket: expanso-demo-logs
    path: logs/demo_\${!timestamp_unix()}.jsonl
    batching:
      count: 10
      period: 10s
    credentials:
      profile: expanso-demo`,
    inputLines: [
      { content: '{', indent: 0 },
      { content: '"event": {', indent: 1 },
      { content: '"id": "a1b2c3d4-e5f6-7890-abcd-ef1234567890",', indent: 2, key: 'id', valueType: 'string' },
      { content: '"timestamp": "2024-01-15T10:30:00Z",', indent: 2, key: 'timestamp', valueType: 'string' },
      { content: '"level": "INFO",', indent: 2, key: 'level', valueType: 'string' },
      { content: '"service": "demo-service",', indent: 2, key: 'service', valueType: 'string' },
      { content: '"message": "Demo log message from edge",', indent: 2, key: 'message', valueType: 'string' },
      { content: '"user_id": "user_123",', indent: 2, key: 'user_id', valueType: 'string' },
      { content: '"request_id": "b2c3d4e5-f6a7-8901-bcde-f12345678901"', indent: 2, key: 'request_id', valueType: 'string' },
      { content: '},', indent: 1 },
      { content: '"metadata": {', indent: 1 },
      { content: '"node_id": "edge-node-01",', indent: 2, key: 'node_id', valueType: 'string' },
      { content: '"pipeline": "log-enrichment-s3-demo",', indent: 2, key: 'pipeline', valueType: 'string' },
      { content: '"processed_at": "2024-01-15T10:30:00.123Z"', indent: 2, key: 'processed_at', valueType: 'string' },
      { content: '}', indent: 1 },
      { content: '}', indent: 0 },
    ],
    outputLines: [
      { content: '# Batching: 10 messages or 10 seconds', indent: 0 },
      { content: '# Output: s3://expanso-demo-logs/logs/demo_1705315800.jsonl', indent: 0 },
      { content: '', indent: 0 },
      { content: '[10 messages batched]', indent: 0, type: 'highlighted' },
    ],
  },
  {
    id: 5,
    title: "Ready for S3 Export",
    description: "Final JSON Lines format optimized for S3 storage with proper partitioning and metadata organization.",
    yamlFilename: "output.jsonl",
    yamlCode: `# S3 File: logs/demo_1705315800.jsonl
{"event":{"id":"...","timestamp":"...","level":"INFO",...},"metadata":{"node_id":"edge-node-01",...}}
{"event":{"id":"...","timestamp":"...","level":"ERROR",...},"metadata":{"node_id":"edge-node-01",...}}
{"event":{"id":"...","timestamp":"...","level":"WARN",...},"metadata":{"node_id":"edge-node-01",...}}
...`,
    inputLines: [
      { content: '[Batch of 10 messages]', indent: 0 },
    ],
    outputLines: [
      { content: '# S3 Location: s3://expanso-demo-logs/logs/demo_1705315800.jsonl', indent: 0, type: 'highlighted' },
      { content: '# Format: JSON Lines', indent: 0, type: 'highlighted' },
      { content: '# Messages: 10', indent: 0, type: 'highlighted' },
      { content: '# Cost Optimized: true', indent: 0, type: 'highlighted' },
      { content: '# Analytics Ready: true', indent: 0, type: 'highlighted' },
    ],
  }
];

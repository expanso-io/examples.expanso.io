---
title: Troubleshooting
sidebar_label: Troubleshooting
sidebar_position: 7
description: Common payment PII deletion issues and solutions
keywords: [troubleshooting, debug, payment, pii, pci-dss]
---

# Troubleshooting

## Quick Diagnosis

```bash
# Check container status
docker ps | grep payment-pii

# Check recent logs
docker logs payment-pii --tail 50 2>&1 | grep -i error

# Test PII deletion
curl -X POST http://localhost:8080/payments \
  -H "Content-Type: application/json" \
  -d '{"card_number": "4532-1234-5678-9010", "amount": 100}'
```

## Common Issues

### Card numbers not being deleted

**Cause:** Field name doesn't match expected pattern

```bash
# Check what fields are being received
docker logs payment-pii --tail 20 2>&1 | grep card
```

**Fix:** Ensure your mapping handles the actual field names:
```yaml
- mapping: |
    root = this
    root.card_number = deleted()      # Or your actual field name
    root.full_number = deleted()
    root.payment_method.number = deleted()
```

---

### Last 4 digits not preserved

**Cause:** Delete happening before extraction

**Fix:** Extract last 4 before deleting:
```yaml
- mapping: |
    root.last_four = this.card_number.slice(-4)
    root.card_number = deleted()
```

---

### Output still contains PII (compliance failure)

**Cause:** Nested fields or unexpected field names not handled

```bash
# Check output for PII patterns
docker logs payment-pii --tail 50 2>&1 | grep -E "[0-9]{13,19}"
```

**Fix:** Add validation step to catch missed PII:
```yaml
- mapping: |
    if this.string().contains_any(["4532", "5412", "3782"]) {
      throw("PII detected in output")
    }
```

---

### Pipeline errors on malformed input

**Cause:** Missing error handling for invalid JSON

**Fix:** Add input validation with fallback:
```yaml
- mapping: |
    root = this.catch({"error": "invalid_input", "raw": content()})
```

## Still stuck?

1. Add debug logging: `logger: {level: DEBUG}`
2. Check the [Complete Pipeline](./complete-payment-pipeline) for reference config
3. Review [Remove PII](../remove-pii/) for general PII removal patterns

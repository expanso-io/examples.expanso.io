---
title: "Step 1: Delete High-Risk Payment PII"
sidebar_label: "Step 1: Delete Payment PII"
sidebar_position: 3
description: Identify and delete high-risk PCI-DSS data like credit card numbers.
keywords: [pci-dss, pii-removal, delete, without, cardholder-data]
---

# Step 1: Delete High-Risk Payment PII

The most critical step in achieving PCI-DSS compliance is to **stop storing data you don't need**. This step teaches you how to identify and completely remove the most sensitive payment card information from your data.

## The Goal

According to the PCI-DSS standard, you should never store the full credit card number (PAN), the expiration date, or the CVV after a transaction is authorized. Your goal is to remove these three high-risk fields from the `payment_method` object.

**Input Message Snippet:**
```json
{
  "payment_method": {
    "full_number": "4532-1234-5678-9010",
    "expiry": "12/25",
    "cvv": "123",
    "last_four": "9010"
  }
}
```

**Desired Output Snippet:**
```json
{
  "payment_method": {
    "last_four": "9010"
  }
}
```

## Implementation

1.  **Deploy the Leaky Pipeline:** The `payment-pii-foundation.yaml` file represents a pipeline that currently leaks PII. Deploy it and send a test event to see the problem.

    ```bash
    # Deploy the foundation pipeline
    expanso job deploy examples/data-security/payment-pii-foundation.yaml

    # Send the sample payment data from the setup step
    # (The data is in ~/expanso-payment-pii/sample-payments.json)
    curl -X POST http://localhost:8080/events/payment \
      -H "Content-Type: application/json" \
      -d @~/expanso-payment-pii/sample-payments.json
    ```
    Check your logs. You will see the `full_number`, `expiry`, and `cvv` fields being printed in clear text.

2.  **Create the Secure Pipeline:** Copy the foundation to a new file.
    ```bash
    cp examples/data-security/payment-pii-foundation.yaml delete-pii.yaml
    ```

3.  **Add the Deletion Logic:** Open `delete-pii.yaml` and add a `mapping` processor to the `pipeline` section. This processor uses the `.without()` function to remove the sensitive fields.

    ```yaml title="Add this to the 'processors' array in delete-pii.yaml"
    # This goes after the existing 'mapping' processor
    - mapping: |
        root = this
        # The .without() function removes fields from an object.
        root.payment_method = this.payment_method.without(
          "full_number",
          "expiry",
          "cvv"
        )
    ```

4.  **Deploy and Test Again:**
    ```bash
    # Deploy the new, secure pipeline
    expanso job deploy delete-pii.yaml

    # Send the same test data
    curl -X POST http://localhost:8080/events/payment \
      -H "Content-Type: application/json" \
      -d @~/expanso-payment-pii/sample-payments.json
    ```

5.  **Verify:** Check your logs again. The output will now show the `payment_method` object with only the `last_four` field remaining. The high-risk PII has been successfully removed.

You have now taken the single most important step towards PCI-DSS compliance.
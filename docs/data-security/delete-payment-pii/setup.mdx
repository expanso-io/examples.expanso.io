---
title: Setup Environment for Payment PII Deletion
sidebar_label: Setup
sidebar_position: 2
description: Configure environment, sample payment data, and deploy a shell payment pipeline
keywords: [setup, environment, payment-data, pci-dss, configuration, deployment]
---

# Setup Environment for Payment PII Deletion

Before building the payment PII deletion pipeline, you'll set up sample payment data, configure your environment, and deploy a minimal "shell" pipeline that verifies your setup works.

## Prerequisites

- **Kafka:** Set up [Kafka](/getting-started/local-development#kafka) for secure payment data delivery
- **Expanso:** Installed and running ([Installation Guide](https://docs.expanso.io/installation))
- **Environment Variables:** See the [local development guide](/getting-started/local-development#environment-variables)

## Step 1: Verify Expanso CLI Installation

Confirm your CLI is working and connected:

```bash
# Check CLI version
expanso version

# Verify connectivity
expanso auth status
```

**Expected output:**
```
Expanso CLI v1.2.0
âœ… Authenticated as user@company.com
âœ… Connected to https://api.expanso.io
```

If you see authentication errors, run `expanso auth login` and follow the prompts.

## Step 2: Create Sample Payment Data

Create realistic sample payment events that contain the PII we need to remove:

```bash
# Create project directory
mkdir -p ~/expanso-payment-pii
cd ~/expanso-payment-pii

# Create sample payment events
cat > sample-payments.json << 'EOF'
{
  "event_type": "purchase",
  "transaction_id": "txn_001",
  "timestamp": "2024-12-15T14:30:00Z",
  "amount": 89.99,
  "currency": "USD",
  "merchant": {
    "id": "merchant_123",
    "name": "Coffee Shop Downtown",
    "category": "food_beverage"
  },
  "payment_method": {
    "full_number": "4532-1234-5678-9010",
    "expiry": "12/25", 
    "cvv": "123",
    "type": "credit_card",
    "brand": "visa",
    "last_four": "9010"
  },
  "customer": {
    "id": "cust_456",
    "email": "sarah@example.com"
  }
}
{
  "event_type": "purchase", 
  "transaction_id": "txn_002",
  "timestamp": "2024-12-15T14:32:15Z",
  "amount": 24.50,
  "currency": "USD",
  "merchant": {
    "id": "merchant_789",
    "name": "Gas Station Express",
    "category": "automotive"
  },
  "payment_method": {
    "full_number": "5555-4444-3333-2222",
    "expiry": "09/26",
    "cvv": "456", 
    "type": "credit_card",
    "brand": "mastercard",
    "last_four": "2222"
  },
  "customer": {
    "id": "cust_789",
    "email": "mike@example.com"
  }
}
{
  "event_type": "purchase",
  "transaction_id": "txn_003", 
  "timestamp": "2024-12-15T14:35:42Z",
  "amount": 156.78,
  "currency": "USD",
  "merchant": {
    "id": "merchant_456",
    "name": "Electronics Depot",
    "category": "electronics"
  },
  "payment_method": {
    "full_number": "3782-822463-10005",
    "expiry": "07/24",
    "cvv": "7373",
    "type": "credit_card", 
    "brand": "amex",
    "last_four": "0005"
  },
  "customer": {
    "id": "cust_123", 
    "email": "alex@example.com"
  }
}
EOF
```

This sample data contains:
- âœ… **Safe fields:** transaction_id, amount, currency, merchant info, last_four
- âŒ **High-risk PII:** full_number, expiry, cvv (violate PCI-DSS)
- ðŸŸ¡ **Moderate PII:** customer email (not payment-specific)

## Step 3: Deploy Shell Payment Pipeline

Before adding PII removal logic, deploy a minimal "shell" pipeline that just passes data through. This verifies your setup works.

Create `shell-payment-pipeline.yaml`:

```yaml title="shell-payment-pipeline.yaml"
# Shell Payment Pipeline - Pass-through for testing
name: shell-payment-pipeline
type: pipeline
config:
  # Accept payment events via HTTP
  input:
    http_server:
      address: "0.0.0.0:8080"
      path: /events/payment
      
  # No processing yet - just pass through
  pipeline:
    processors:
      - mapping: |
          # Pass everything through unchanged (for now)
          root = this
          
          # Add processing timestamp for testing
          root.processed_at = now().format("2006-01-02T15:04:05Z")

  # Output to console for testing (will change to analytics later)
  output:
    stdout:
      codec: lines
```

Deploy the shell pipeline:

```bash
# Deploy to Expanso
expanso job deploy shell-payment-pipeline.yaml

# Verify deployment
expanso job list
```

**Expected output:**
```
NAME                     STATUS    CREATED
shell-payment-pipeline   Running   2024-12-15T14:30:00Z
```

## Step 4: Test Shell Pipeline

Send sample payment data through the pipeline to verify it's working:

```bash
# Get the pipeline endpoint
PIPELINE_URL=$(expanso job describe shell-payment-pipeline | grep "endpoint" | cut -d'"' -f4)
echo "Pipeline endpoint: $PIPELINE_URL"

# Send first payment event
curl -X POST $PIPELINE_URL/events/payment \
  -H "Content-Type: application/json" \
  -d @sample-payments.json

# Check the output logs
expanso job logs shell-payment-pipeline
```

**Expected output:**
```
{"event_type":"purchase","transaction_id":"txn_001","timestamp":"2024-12-15T14:30:00Z",...,"processed_at":"2024-12-15T14:31:22Z"}
{"event_type":"purchase","transaction_id":"txn_002","timestamp":"2024-12-15T14:32:15Z",...,"processed_at":"2024-12-15T14:31:22Z"}
{"event_type":"purchase","transaction_id":"txn_003","timestamp":"2024-12-15T14:35:42Z",...,"processed_at":"2024-12-15T14:31:22Z"}
```

:::tip Success!
If you see payment events in the logs with `processed_at` timestamps, your environment is correctly configured!

**Next step:** Start learning about payment PII identification and removal.
:::

## Step 5: Verify Payment Data Structure

Before proceeding, let's examine what PII fields are present in our sample data:

```bash
# Extract just the payment_method fields to see what we're working with
cat sample-payments.json | jq '.payment_method'
```

**Expected output:**
```json
{
  "full_number": "4532-1234-5678-9010",
  "expiry": "12/25",
  "cvv": "123", 
  "type": "credit_card",
  "brand": "visa",
  "last_four": "9010"
}
{
  "full_number": "5555-4444-3333-2222", 
  "expiry": "09/26",
  "cvv": "456",
  "type": "credit_card",
  "brand": "mastercard", 
  "last_four": "2222"
}
{
  "full_number": "3782-822463-10005",
  "expiry": "07/24", 
  "cvv": "7373",
  "type": "credit_card",
  "brand": "amex",
  "last_four": "0005"
}
```

Perfect! This shows us exactly what we need to remove:
- âŒ `full_number` - Primary Account Number (PAN), highest risk
- âŒ `expiry` - Cardholder data, moderate risk  
- âŒ `cvv` - Sensitive authentication data, highest risk
- âœ… `type`, `brand`, `last_four` - Safe for analytics

## Step 6: Set Environment Variables

Set up environment variables for the tutorial:

```bash
# Create environment configuration
cat > .env << 'EOF'
# Expanso Configuration
EXPANSO_PROJECT_NAME=payment-pii-tutorial
EXPANSO_PIPELINE_NAME=delete-payment-pii

# Data Configuration  
SAMPLE_DATA_FILE=sample-payments.json
SHELL_PIPELINE_CONFIG=shell-payment-pipeline.yaml

# Testing Configuration
TEST_ENDPOINT_PATH=/events/payment
EOF

# Load environment variables
source .env

# Verify they're set
echo "Project: $EXPANSO_PROJECT_NAME"
echo "Pipeline: $EXPANSO_PIPELINE_NAME"
```

## Step 7: Create Testing Script

Create a helper script to test your payment pipelines throughout the tutorial:

```bash
# Create testing script
cat > test-payment-pipeline.sh << 'EOF'
#!/bin/bash

# Test Payment Pipeline Script
set -e

PIPELINE_NAME=${1:-"shell-payment-pipeline"}
DATA_FILE=${2:-"sample-payments.json"}

echo "ðŸ§ª Testing pipeline: $PIPELINE_NAME"
echo "ðŸ“ Using data file: $DATA_FILE"

# Get pipeline endpoint
echo "ðŸ“¡ Getting pipeline endpoint..."
ENDPOINT=$(expanso job describe $PIPELINE_NAME | grep "endpoint" | cut -d'"' -f4)

if [ -z "$ENDPOINT" ]; then
  echo "âŒ Could not find endpoint for pipeline $PIPELINE_NAME"
  echo "ðŸ’¡ Make sure the pipeline is deployed and running"
  exit 1
fi

echo "ðŸ”— Endpoint: $ENDPOINT/events/payment"

# Send test data
echo "ðŸ“¤ Sending test payment events..."
curl -s -X POST $ENDPOINT/events/payment \
  -H "Content-Type: application/json" \
  -d @$DATA_FILE

echo -e "\nâœ… Events sent successfully!"

# Show recent logs
echo "ðŸ“‹ Recent pipeline logs:"
expanso job logs $PIPELINE_NAME --tail 10
EOF

# Make it executable
chmod +x test-payment-pipeline.sh

# Test the script
echo "ðŸ§ª Testing the shell pipeline..."
./test-payment-pipeline.sh
```

## Environment Verification Checklist

Before proceeding to the next step, verify:

- [ ] âœ… Expanso CLI installed and authenticated
- [ ] âœ… Sample payment data created (`sample-payments.json`)
- [ ] âœ… Shell pipeline deployed and running
- [ ] âœ… Test script working (`test-payment-pipeline.sh`)
- [ ] âœ… Environment variables configured (`.env`)
- [ ] âœ… Can send events and see logs

---

## Next Steps

Your environment is ready! Now you'll learn to identify which payment fields require PCI-DSS controls and which are safe to keep for analytics.

<div style={{display: 'flex', gap: '1.5rem', marginTop: '2rem', marginBottom: '3rem', flexWrap: 'wrap', justifyContent: 'flex-start'}}>
  <a href="./step-1-identify-payment-pii" className="button button--primary button--lg" style={{display: 'inline-flex', alignItems: 'center', justifyContent: 'center', textDecoration: 'none', borderRadius: '8px', padding: '1rem 2rem', fontWeight: '600', minWidth: '240px', boxShadow: '0 2px 8px rgba(0,0,0,0.15)', cursor: 'pointer', transition: 'all 0.2s ease'}}>
    Step 1: Identify Payment PII
  </a>
  <a href="../" className="button button--secondary button--lg" style={{display: 'inline-flex', alignItems: 'center', justifyContent: 'center', textDecoration: 'none', borderRadius: '8px', padding: '1rem 2rem', fontWeight: '600', minWidth: '240px', boxShadow: '0 2px 8px rgba(0,0,0,0.15)', cursor: 'pointer', transition: 'all 0.2s ease'}}>
    Back to Introduction
  </a>
</div>

## What You've Accomplished

âœ… **Environment configured** with Expanso CLI and authentication  
âœ… **Sample payment data** created with realistic PII scenarios  
âœ… **Shell pipeline** deployed and tested successfully  
âœ… **Testing tools** created for iterative development  
âœ… **Ready to learn** payment PII identification and removal techniques

**Next:** [Learn to identify high-risk payment fields](./step-1-identify-payment-pii) that require PCI-DSS controls.

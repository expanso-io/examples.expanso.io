---
title: Complete Schema Validation Pipeline
sidebar_label: Complete Pipeline
sidebar_position: 7
description: The complete schema validation pipeline with DLQ routing
keywords: [complete, schema, validation, dlq]
---

import CodeBlock from '@theme/CodeBlock';
import pipelineYaml from '!!raw-loader!../../../examples/data-security/enforce-schema-complete.yaml';
import CopyPipelineButton from '@site/src/components/CopyPipelineButton';

# Complete Pipeline

<CopyPipelineButton pipeline={pipelineYaml} />

This pipeline combines all schema validation techniques from this tutorial:

- **JSON Schema validation** - Validate incoming data against defined schema
- **Smart routing** - Valid data → analytics, invalid data → DLQ
- **Error enrichment** - Add validation error details to failed messages
- **Quality metrics** - Track validation pass/fail rates

## Full Configuration

<CodeBlock language="yaml" title="enforce-schema.yaml">{pipelineYaml}</CodeBlock>

## Quick Test

```bash
# Send valid sensor data
curl -X POST http://localhost:8080/sensors \
  -H "Content-Type: application/json" \
  -d '{
    "sensor_id": "temp-001",
    "temperature": 72.5,
    "humidity": 45.0,
    "timestamp": "2024-01-15T10:30:00Z"
  }'
# Result: Routed to analytics

# Send invalid data (missing required field)
curl -X POST http://localhost:8080/sensors \
  -H "Content-Type: application/json" \
  -d '{
    "sensor_id": "temp-001",
    "temperature": "not-a-number"
  }'
# Result: Routed to DLQ with validation error details
```

## Deploy

```bash
# Deploy to Expanso orchestrator
expanso-cli job deploy enforce-schema.yaml

# Or run locally with expanso-edge
expanso-edge run --config enforce-schema.yaml
```

## Download

<a href="/examples/data-security/enforce-schema-complete.yaml" download className="button button--primary">
  Download enforce-schema.yaml
</a>

## What's Next?

- [Troubleshooting](./troubleshooting) - Common issues and solutions
- [Remove PII](../remove-pii/) - Delete personal information

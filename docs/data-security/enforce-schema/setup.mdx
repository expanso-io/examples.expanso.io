---
title: Setup Environment for Schema Validation
sidebar_label: Setup
sidebar_position: 2
description: Configure edge nodes and sample data for schema validation.
keywords: [setup, environment, configuration, edge nodes, schema validation]
---

# Setup Environment for Schema Validation

Before building the complete schema validation solution, you'll set up edge nodes and prepare sample data.

## Prerequisites

This example requires the following services to be running:

*   **[Kafka](/getting-started/services/kafka)**

Before you begin, please ensure these services are set up and running according to their respective guides. Additionally, ensure you have completed the [Local Development Setup](/getting-started/local-development) guide for general environment configuration.

## Step 1: Verify Edge Node Configuration

Confirm your edge nodes are properly configured for schema validation:

```bash
# Check edge node status
expanso node list

# Verify node labels for schema validation
expanso node describe <NODE_ID> | grep -A 5 "labels"
```

**Expected output:**
```
NODE_ID                           STATUS    ROLE              LABELS
edge-sensor-001                   ready     sensor-collector  validation=required
edge-sensor-002                   ready     sensor-collector  validation=required
```

If your nodes don't have the required labels, add them:

```bash
# Add required labels to edge nodes
expanso node label edge-sensor-001 role=sensor-collector validation=required
expanso node label edge-sensor-002 role=sensor-collector validation=required

# Verify labels were added
expanso node describe edge-sensor-001 | grep validation
```

## Step 2: Create Schema Directory on Edge Nodes

Schema files need to be accessible to validation processors on each edge node:

```bash
# Connect to each edge node and create schema directory
for node in edge-sensor-001 edge-sensor-002; do
  echo "Setting up schema directory on $node..."
  
  # Create directory for schema files
  expanso node exec $node -- mkdir -p /etc/expanso/schemas
  
  # Set proper permissions
  expanso node exec $node -- chmod 755 /etc/expanso/schemas
  
  # Verify directory exists
  expanso node exec $node -- ls -ld /etc/expanso/schemas
done
```

## Step 3: Prepare Sample Sensor Data

Create test data to verify schema validation works correctly:

```bash
# Create sample data directory
mkdir -p /tmp/sensor-test-data

# Create valid sensor reading
cat > /tmp/sensor-test-data/valid-reading.json << 'EOF'
{
  "sensor_id": "sensor-42",
  "timestamp": "2025-10-20T14:30:00Z",
  "location": {
    "building": "warehouse-3",
    "floor": 2,
    "zone": "A"
  },
  "readings": {
    "temperature_celsius": 23.5,
    "humidity_percent": 45.2
  },
  "metadata": {
    "firmware_version": "2.1.0",
    "battery_percent": 87
  }
}
EOF

# Create invalid sensor reading (missing required fields)
cat > /tmp/sensor-test-data/invalid-reading-1.json << 'EOF'
{
  "sensor_id": "sensor-99",
  "timestamp": "2025-10-20T14:30:00Z"
}
EOF

# Create invalid sensor reading (wrong data types)
cat > /tmp/sensor-test-data/invalid-reading-2.json << 'EOF'
{
  "sensor_id": "sensor-42",
  "timestamp": "2025-10-20T14:30:00Z",
  "location": {
    "building": "warehouse-3",
    "floor": "second floor",
    "zone": "A"
  },
  "readings": {
    "temperature_celsius": "twenty-three point five",
    "humidity_percent": 45.2
  },
  "metadata": {
    "firmware_version": "2.1.0",
    "battery_percent": 87
  }
}
EOF

# Create invalid sensor reading (values out of range)
cat > /tmp/sensor-test-data/invalid-reading-3.json << 'EOF'
{
  "sensor_id": "sensor-42",
  "timestamp": "not-a-timestamp",
  "location": {
    "building": "warehouse-3",
    "floor": 2,
    "zone": "A"
  },
  "readings": {
    "temperature_celsius": -500,
    "humidity_percent": 150
  },
  "metadata": {
    "firmware_version": "2.1.0",
    "battery_percent": 87
  }
}
EOF

# Verify test data files
echo "Test data files created:"
ls -la /tmp/sensor-test-data/
echo ""

echo "Valid reading sample:"
jq . /tmp/sensor-test-data/valid-reading.json
```

## Step 4: Set Environment Variables

Configure endpoints for analytics and metrics collection:

```bash
# Set up environment variables for pipeline configuration
export ANALYTICS_ENDPOINT="http://localhost:9000"
export METRICS_ENDPOINT="http://localhost:9001"
export NODE_ID="edge-sensor-001"

# Verify environment variables
echo "Analytics endpoint: $ANALYTICS_ENDPOINT"
echo "Metrics endpoint: $METRICS_ENDPOINT"
echo "Node ID: $NODE_ID"
```

## Step 5: Set Up Mock Analytics Endpoint

Create a simple HTTP server to capture messages for testing:

```bash
# Start mock analytics endpoint in background
echo "Starting mock analytics endpoint..."
python3 -m http.server 9000 --bind localhost &
ANALYTICS_PID=$!

echo "Analytics endpoint PID: $ANALYTICS_PID"

# Start mock metrics endpoint  
python3 -m http.server 9001 --bind localhost &
METRICS_PID=$!

echo "Metrics endpoint PID: $METRICS_PID"
```

## Next Steps

With your environment set up and verified, you're ready to build the complete schema validation solution:

<div style={{display: 'flex', gap: '1.5rem', marginTop: '2rem', marginBottom: '3rem', flexWrap: 'wrap', justifyContent: 'flex-start'}}>
  <a href="./step-1-define-json-schema" className="button button--primary button--lg" style={{display: 'inline-flex', alignItems: 'center', justifyContent: 'center', textDecoration: 'none', borderRadius: '8px', padding: '1rem 2rem', fontWeight: '600', minWidth: '240px', boxShadow: '0 2px 8px rgba(0,0,0,0.15)', cursor: 'pointer', transition: 'all 0.2s ease'}}>
    Step 1: Define JSON Schema
  </a>
  <a href="./troubleshooting" className="button button--secondary button--lg" style={{display: 'inline-flex', alignItems: 'center', justifyContent: 'center', textDecoration: 'none', borderRadius: '8px', padding: '1rem 2rem', fontWeight: '600', minWidth: '240px', boxShadow: '0 2px 8px rgba(0,0,0,0.15)', cursor: 'pointer', transition: 'all 0.2s ease'}}>
    Troubleshooting Guide
  </a>
</div>
